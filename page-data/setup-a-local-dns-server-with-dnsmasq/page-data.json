{"componentChunkName":"component---src-templates-post-jsx","path":"/setup-a-local-dns-server-with-dnsmasq/","result":{"data":{"markdownRemark":{"html":"<p>在程序开发过程当中，有时会碰到需要自定义子域名解析，比如把<code class=\"language-text\">*.example.com</code>的所有请求转发到本地开发服务器。由于<code class=\"language-text\">/etc/hosts</code>配置并不支持通配符（<code class=\"language-text\">*</code>），所以需要自己设置一个本地 DNS 服务器。</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Dnsmasq\">dnsmasq</a> 是一个轻量级的，支持 DNS 转发、DHCP 等功能的 DNS 服务器软件，可以运行在 Linux、macOS 平台。</p>\n<p><strong>下面内容以 macOS 平台为例，Linux 版本使用“dnsmasq ubuntu”之类关键词搜索可以得到很多相关文章。</strong></p>\n<h2 id=\"安装\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%85\" aria-label=\"安装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装</h2>\n<p>使用 <a href=\"https://brew.sh/\">Homebrew</a> 安装：</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">brew install dnsmasq</code></pre></div>\n<h2 id=\"配置\" style=\"position:relative;\"><a href=\"#%E9%85%8D%E7%BD%AE\" aria-label=\"配置 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>配置</h2>\n<ul>\n<li>在目录<code class=\"language-text\">$(brew --prefix)/etc</code>当中创建一个<code class=\"language-text\">dnsmasq.conf</code>文件（如果已存在就不用创建）。</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">mkdir -p $(brew --prefix)/etc/\ntouch $(brew --prefix)/etc/dnsmasq.conf</code></pre></div>\n<ul>\n<li>在<code class=\"language-text\">dnsmasq.conf</code>文件中追加以下内容：</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 下面配置表示所有以`example.com`为后缀的域名（包括`example.com`）都解析到`127.0.0.1`\n# 你还可以解析其他任意后缀，比如`address=/dev/127.0.0.1`将所有`dev`域名解析到`127.0.0.1`\naddress=/example.com/127.0.0.1\n# 使用 DNS 默认端口号 53\nport=53</code></pre></div>\n<ul>\n<li>创建一个 <a href=\"https://icannwiki.org/Domain_Name_Resolvers\">DNS 解析器（dns resolver）</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">sudo mkdir /etc/resolver\nsudo bash -c &#39;echo &quot;nameserver 127.0.0.1&quot; &gt; /etc/resolver/example.com&#39;</code></pre></div>\n<ul>\n<li>启动</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">sudo /usr/local/opt/dnsmasq/sbin/dnsmasq -C /usr/local/etc/dnsmasq.conf</code></pre></div>\n<ul>\n<li>也可以设置为开机启动</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">sudo brew services start dnsmasq</code></pre></div>\n<ul>\n<li>使用<code class=\"language-text\">ping</code>测试</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">ping example.com\nping 1.example.com</code></pre></div>\n<p>可以看到类似下面的结果（来源于地址<code class=\"language-text\">127.0.0.1</code>）：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.016 ms\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.031 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.087 ms\n...</code></pre></div>\n<h2 id=\"相关资源\" style=\"position:relative;\"><a href=\"#%E7%9B%B8%E5%85%B3%E8%B5%84%E6%BA%90\" aria-label=\"相关资源 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>相关资源</h2>\n<ul>\n<li><a href=\"https://medium.com/@kharysharpe/automatic-local-domains-setting-up-dnsmasq-for-macos-high-sierra-using-homebrew-caf767157e43\">/usr/local/opt/dnsmasq/sbin/dnsmasq --keep-in-foreground -C /usr/local/etc/dnsmasq.con</a></li>\n<li><a href=\"http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html\">dnsmasq man page</a></li>\n</ul>","timeToRead":2,"excerpt":"在程序开发过程当中，有时会碰到需要自定义子域名解析，比如把的所有请求转发到本地开发服务器。由于配置并不支持通配符（），所以需要自己设置一个本地 DNS 服务器。 dnsmasq 是一个轻量级的，支持 DNS 转发、DHCP 等功能的 DNS 服务器软件，可以运行在 Linux…","frontmatter":{"title":"使用 dnsmasq 设置一个本地 DNS 服务器","cover":"","date":"2019-03-24 22:00","category":"网络","tags":["DNS","DNS Server","dnsmasq"]},"fields":{"slug":"/setup-a-local-dns-server-with-dnsmasq/","date":"2019-03-23T16:00:00.000Z"}}},"pageContext":{"slug":"/setup-a-local-dns-server-with-dnsmasq/"}},"staticQueryHashes":[]}