{"componentChunkName":"component---src-templates-post-jsx","path":"/npm-package-security-vulnerability/","result":{"data":{"markdownRemark":{"html":"<p>自从 npm 在执行<code class=\"language-text\">npm install</code>命令时自动开启安全审计（<code class=\"language-text\">npm audit</code>）之后，很多前端或 Node.js 项目都报出几个或者一堆安全缺陷问题，尤其对于庞大的旧项目，数百乃至上万个安全缺陷问题。后来，Github 添加了 Security 功能，对项目开启依赖自动审计后，就不断接收到依赖存在安全缺陷的消息。之前只是简单的通过<code class=\"language-text\">npm audit fix</code>或者升级依赖来解决，这通常能解决绝大部分问题，然后并没有仔细研究过这方面，现在是时候了。</p>\n<h2 id=\"何为安全缺陷（security-vulnerability）？\" style=\"position:relative;\"><a href=\"#%E4%BD%95%E4%B8%BA%E5%AE%89%E5%85%A8%E7%BC%BA%E9%99%B7%EF%BC%88security-vulnerability%EF%BC%89%EF%BC%9F\" aria-label=\"何为安全缺陷（security vulnerability）？ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>何为安全缺陷（Security Vulnerability）？</h2>\n<p>根据维基百科 <a href=\"https://en.wikipedia.org/wiki/Vulnerability_(computing)\">Vulnerability</a> 定义：</p>\n<blockquote>\n<p>In computer security, a vulnerability is a weakness which can be exploited by a threat actor, such as an attacker, to perform unauthorized actions within a computer system.</p>\n</blockquote>\n<p>即，在电脑安全领域，缺陷是指可以被攻击者来利用的弱点，攻击者可以用来在电脑系统当中执行一些未授许可的操作。比如，访问一些没有权限的数据，修改没有权限的数据，使系统正常的服务出现问题等等。因此，作为开发者需要关注应用的安全缺陷，作为开源维护者更需要关注安全问题，也即项目<strong>缺陷管理（Vulnerability Management）</strong>。</p>\n<p>我们可以经常接触到的前端代码安全缺陷管理主要是<code class=\"language-text\">npm audit</code>命令以及 Github Security 功能。另外，还有很多免费或商业的代码安全审计服务。</p>\n<h2 id=\"npm-audit\" style=\"position:relative;\"><a href=\"#npm-audit\" aria-label=\"npm audit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>npm audit</h2>\n<p><strong>注意：<code class=\"language-text\">npm audit</code>命令在 npm@6 当中添加。</strong></p>\n<p>执行<code class=\"language-text\">npm audit</code>命令需要存在<code class=\"language-text\">package.json</code>和<code class=\"language-text\">package-lock.json</code>文件，否则会报错。</p>\n<p>执行<code class=\"language-text\">npm audit</code>之后，会输出类似于下面的安全报告表格以及不同严重级别的总数。</p>\n<div class=\"gatsby-highlight\" data-language=\"txt\"><pre class=\"language-txt\"><code class=\"language-txt\"># Run  npm update handlebars --depth 7 to resolve 1 vulnerability\n┌───────────────┬──────────────────────────────────────────────────────────────┐\n│ High          │ Prototype Pollution                                          │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Package       │ handlebars                                                   │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Dependency of │ jest [dev]                                                   │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ Path          │ jest &gt; jest-cli &gt; @jest/core &gt; @jest/reporters &gt;             │\n│               │ istanbul-reports &gt; handlebars                                │\n├───────────────┼──────────────────────────────────────────────────────────────┤\n│ More info     │ https://npmjs.com/advisories/1325                            │\n└───────────────┴──────────────────────────────────────────────────────────────┘\nfound 38015 vulnerabilities (37997 low, 15 moderate, 3 high) in 877392 scanned packages\n  run `npm audit fix` to fix 37905 of them.\n  104 vulnerabilities require semver-major dependency updates.\n  6 vulnerabilities require manual review. See the full report for details.</code></pre></div>\n<h3 id=\"审计报告（audit-report）\" style=\"position:relative;\"><a href=\"#%E5%AE%A1%E8%AE%A1%E6%8A%A5%E5%91%8A%EF%BC%88audit-report%EF%BC%89\" aria-label=\"审计报告（audit report） permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>审计报告（Audit Report）</h3>\n<p>上面的表格是审计报告，包含严重性（Severity）、缺陷描述、缺陷来源包、依赖缺陷包的包、依赖路径、更多信息链接。详细解读查看 <a href=\"https://docs.npmjs.com/about-audit-reports\">About audit reports</a>。</p>\n<h3 id=\"修复缺陷\" style=\"position:relative;\"><a href=\"#%E4%BF%AE%E5%A4%8D%E7%BC%BA%E9%99%B7\" aria-label=\"修复缺陷 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>修复缺陷</h3>\n<ul>\n<li>使用<code class=\"language-text\">npm audit fix</code>修复所有可修复的缺陷。</li>\n<li>使用审计报告提示的命令<code class=\"language-text\">npm update handlebars --depth 7</code>来升级存在缺陷的 handlebars 包，该命令会修改<code class=\"language-text\">package-lock.json</code>，也需要把该文件添加到源码仓库里面。</li>\n<li>直接升级项目<code class=\"language-text\">package.json</code>里面的依赖。</li>\n</ul>\n<h2 id=\"github-security\" style=\"position:relative;\"><a href=\"#github-security\" aria-label=\"github security permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Github Security</h2>\n<p><strong>Github Security</strong> 功能如果发现了依赖当中的安全缺陷会在仓库展示警告信息（只有仓库拥有者才能看到），另外也有通过发送消息来提醒。<strong>Security Alerts</strong> 页面可以查看具体哪些依赖存在问题，可以生成自动更新 Pull Request。具体的使用文档可以查看 <a href=\"https://help.github.com/en/github/managing-security-vulnerabilities/managing-vulnerabilities-in-your-projects-dependencies\">Managing vulnerabilities in your project's dependencies</a>。</p>\n<p>当然，使用 Github Security 来作为提醒，使用 npm audit 来解决是一种不错的结合。另外，Github Security 有 <a href=\"https://nvd.nist.gov/\">CVE</a> 链接，npm 审计报告有更多信息链接，这些链接可以查看更详细的关于缺陷的描述、分析、资源等。</p>\n<h2 id=\"代码审计服务\" style=\"position:relative;\"><a href=\"#%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E6%9C%8D%E5%8A%A1\" aria-label=\"代码审计服务 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>代码审计服务</h2>\n<p>下面这些都是对开源项目免费的代码审计服务：</p>\n<ul>\n<li><a href=\"https://lgtm.com/\">lgtm</a></li>\n<li><a href=\"https://snyk.io/\">snyk</a></li>\n</ul>\n<p>另外，在 <a href=\"https://github.com/marketplace?category=security\">Github Marketplace</a> 可以发现不少免费的代码审计服务。</p>\n<h2 id=\"总结\" style=\"position:relative;\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h2>\n<ul>\n<li>使用 Github Security 或者免费的代码审计服务来监控安全缺陷。</li>\n<li>使用 npm audit 来修复。</li>\n<li>参考相关链接进一步了解缺陷相关问题。</li>\n</ul>\n<h2 id=\"参考\" style=\"position:relative;\"><a href=\"#%E5%8F%82%E8%80%83\" aria-label=\"参考 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>参考</h2>\n<ul>\n<li><a href=\"https://docs.npmjs.com/auditing-package-dependencies-for-security-vulnerabilities\">Auditing package dependencies for security vulnerabilities</a></li>\n<li><a href=\"https://help.github.com/en/github/managing-security-vulnerabilities\">Managing security vulnerabilities</a></li>\n</ul>","timeToRead":4,"excerpt":"自从 npm 在执行命令时自动开启安全审计（）之后，很多前端或 Node.js 项目都报出几个或者一堆安全缺陷问题，尤其对于庞大的旧项目，数百乃至上万个安全缺陷问题。后来，Github 添加了 Security…","frontmatter":{"title":"npm 包安全缺陷","cover":"","date":"2020-04-11T00:00:00.000Z","category":"安全","tags":["安全","npm","npm package"]},"fields":{"slug":"/npm-package-security-vulnerability/","date":"2020-04-10T16:00:00.000Z"}}},"pageContext":{"slug":"/npm-package-security-vulnerability/"}},"staticQueryHashes":[]}